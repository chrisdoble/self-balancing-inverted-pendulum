(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 13.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     34188,        772]
NotebookOptionsPosition[     30475,        714]
NotebookOutlinePosition[     30866,        730]
CellTagsIndexPosition[     30823,        727]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell["\<\
This notebook contains a simulation of a controlled inverted pendulum on a \
cart.

Import dependencies\
\>", "Text",
 CellChangeTimes->{{3.907268301431198*^9, 
  3.907268313008988*^9}},ExpressionUUID->"0fe5ad29-3401-4caf-8504-\
3a70af6fc6f8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"AppendTo", "[", 
   RowBox[{"$Path", ",", 
    RowBox[{"NotebookDirectory", "[", "]"}]}], "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.907268314527019*^9, 3.9072683203517942`*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"a98d723e-79f2-4a1f-91f4-dc4199237fcd"],

Cell[BoxData[
 RowBox[{"<<", "draw_inverted_pendulum.m"}]], "Input",
 CellChangeTimes->{{3.907268322838881*^9, 3.907268326376525*^9}},
 CellLabel->"In[2]:=",ExpressionUUID->"e35fe735-c611-40a1-ac76-b56affe3acc8"],

Cell["\<\

Define constants\
\>", "Text",
 CellChangeTimes->{{3.907268345224559*^9, 
  3.907268347675578*^9}},ExpressionUUID->"9f09f415-a7d0-48f3-9ca9-\
5597bf6978c2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "Acceleration", " ", "due", " ", "to", " ", "gravity", " ", "in", " ", 
    RowBox[{"m", "/", 
     RowBox[{"s", "^", "2"}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"g", "=", "9.8"}], ";"}]}]], "Input",
 CellChangeTimes->{{3.9072585551220303`*^9, 3.907258556790978*^9}, {
  3.9072596892791348`*^9, 3.907259700848218*^9}, {3.907259879853743*^9, 
  3.907259890304781*^9}},
 CellLabel->"In[3]:=",ExpressionUUID->"127b8550-8a2b-43df-8ffe-22bfb3da5f37"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "The", " ", "length", " ", "of", " ", "the", " ", "pendulum", " ", "in", 
    " ", "m"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"l", "=", "0.43"}], ";"}]}]], "Input",
 CellChangeTimes->{{3.907258565759848*^9, 3.907258566583776*^9}, {
   3.907259702446516*^9, 3.907259707900969*^9}, {3.9072598917632313`*^9, 
   3.9072598920731897`*^9}, {3.907426563181901*^9, 3.907426563627219*^9}, 
   3.9122097084644423`*^9},
 CellLabel->"In[4]:=",ExpressionUUID->"73fec481-6ffd-4575-bb1c-328ed8894f1c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "The", " ", "mass", " ", "of", " ", "the", " ", "cart", " ", "in", " ", 
    "kg"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"m1", "=", "0.103"}], ";"}]}]], "Input",
 CellChangeTimes->{{3.907258523314209*^9, 3.907258524807776*^9}, {
  3.9072597182796593`*^9, 3.9072597238098583`*^9}, {3.9072598951118526`*^9, 
  3.9072598954468193`*^9}, {3.907262194602169*^9, 3.907262250954935*^9}, {
  3.9072709867024107`*^9, 3.907271000466743*^9}, {3.907426570828133*^9, 
  3.9074265711334677`*^9}, {3.912209722117609*^9, 3.912209722315176*^9}, {
  3.915055402887591*^9, 3.915055403318055*^9}},
 CellLabel->"In[5]:=",ExpressionUUID->"f98da995-ad72-405f-9c38-8ac29a0208f3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "The", " ", "mass", " ", "of", " ", "the", " ", "pendulum", " ", "in", " ",
     "kg"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"m2", "=", "0.066"}], ";"}]}]], "Input",
 CellChangeTimes->{{3.907258520100608*^9, 3.907258522316782*^9}, {
  3.907259712475973*^9, 3.907259717026128*^9}, {3.9072598934558573`*^9, 
  3.907259893800728*^9}, {3.90742656630135*^9, 3.90742656700359*^9}, {
  3.912209717772771*^9, 3.912209718087305*^9}, {3.915055406561445*^9, 
  3.9150554067976017`*^9}},
 CellLabel->"In[6]:=",ExpressionUUID->"7393db73-33a9-4bc9-8ca7-fd291343cdb4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "The", " ", "duration", " ", "of", " ", "the", " ", "simulation", " ", 
    "in", " ", "s"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"tMax", "=", "10"}], ";"}]}]], "Input",
 CellChangeTimes->{{3.9072591401843147`*^9, 3.90725914454907*^9}, {
  3.90725964210779*^9, 3.907259642182817*^9}, {3.9072598730585747`*^9, 
  3.9072598992819967`*^9}},
 CellLabel->"In[7]:=",ExpressionUUID->"4bc6e4cb-4e47-43b3-b020-5b0802cbf28f"],

Cell["\<\

Define initial conditions\
\>", "Text",
 CellChangeTimes->{{3.907258644938279*^9, 3.907258662703244*^9}, 
   3.907258709742606*^9},ExpressionUUID->"790e9bb2-8f5a-47ae-939e-\
21677a893ff3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "The", " ", "initial", " ", "angle", " ", "of", " ", "the", " ", 
    "pendulum", " ", "in", " ", "rad"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"\[Theta]0", "=", 
    RowBox[{"Pi", "/", "6"}]}], ";"}]}]], "Input",
 CellChangeTimes->{{3.907258666601866*^9, 3.907258672269446*^9}, {
   3.907259901806073*^9, 3.907259925392294*^9}, {3.907260399660734*^9, 
   3.907260411059881*^9}, {3.907270708018016*^9, 3.907270763716758*^9}, {
   3.907270839849166*^9, 3.907270840435219*^9}, {3.907270888508099*^9, 
   3.907270888580772*^9}, {3.9072974015915728`*^9, 3.907297402308453*^9}, {
   3.907437427394773*^9, 3.907437427715147*^9}, {3.9074378399379883`*^9, 
   3.907437840198688*^9}, {3.907437880499742*^9, 3.907437888253798*^9}, {
   3.9074381074042664`*^9, 3.907438114760803*^9}, {3.9122097734282618`*^9, 
   3.912209773588501*^9}, {3.91317394034437*^9, 3.913173940578609*^9}, {
   3.9132288426287947`*^9, 3.913228845794668*^9}, 3.913261371836958*^9, {
   3.914618933019395*^9, 3.9146189333814898`*^9}, {3.9146193224142714`*^9, 
   3.914619322553905*^9}},
 CellLabel->"In[8]:=",ExpressionUUID->"79887e5c-eb7b-4a70-b0e9-969ec65c98a6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "The", " ", "initial", " ", "angular", " ", "velocity", " ", "of", " ", 
    "the", " ", "pendulum", " ", "in", " ", 
    RowBox[{"rad", "/", "s"}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"\[Omega]0", "=", "0"}], ";"}]}]], "Input",
 CellChangeTimes->{{3.9072586749437103`*^9, 3.9072586830367327`*^9}, {
  3.9072599124529133`*^9, 3.9072599273725767`*^9}, {3.9072707113517323`*^9, 
  3.907270719993931*^9}, {3.907270765968912*^9, 3.907270769215863*^9}, {
  3.9072708376290827`*^9, 3.9072708377215643`*^9}, {3.9072708900941257`*^9, 
  3.907270890433476*^9}, {3.907437382017827*^9, 3.907437382063361*^9}, {
  3.907437425037775*^9, 3.907437425085722*^9}, {3.907437852791716*^9, 
  3.9074378529678926`*^9}},
 CellLabel->"In[9]:=",ExpressionUUID->"d3c23cee-7866-47a4-9538-1454bee2a786"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "The", " ", "initial", " ", "x", " ", "position", " ", "of", " ", "the", 
    " ", "cart", " ", "in", " ", "m"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"x0", "=", "0"}], ";"}]}]], "Input",
 CellChangeTimes->{{3.9072586909188232`*^9, 3.907258692828266*^9}, {
  3.907259928988006*^9, 3.9072599376519938`*^9}},
 CellLabel->"In[10]:=",ExpressionUUID->"86397208-e411-4e20-acb3-989bb4000928"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "The", " ", "initial", " ", "x", " ", "velocity", " ", "of", " ", "the", 
    " ", "cart", " ", "in", " ", 
    RowBox[{"m", "/", "s"}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"v0", "=", "0"}], ";"}]}]], "Input",
 CellChangeTimes->{{3.907258694468794*^9, 3.907258696608348*^9}, {
  3.907259939443335*^9, 3.9072599467379847`*^9}},
 CellLabel->"In[11]:=",ExpressionUUID->"44b7c4ca-50d2-4083-b7ca-a950d5f44d6a"],

Cell["\<\

Define the matrices for the continuous simulation\
\>", "Text",
 CellChangeTimes->{{3.907269021649563*^9, 3.9072690325018587`*^9}, {
   3.90726912084308*^9, 3.907269122367008*^9}, {3.907269212600648*^9, 
   3.907269215504036*^9}, 3.907269274944816*^9, {3.914619103118147*^9, 
   3.91461913164927*^9}},ExpressionUUID->"b7260e88-9646-422b-9c7f-\
4c9c3fe63308"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"The", " ", "state", " ", "matrix"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"a", "=", 
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"0", ",", " ", "1", ",", " ", "0", ",", " ", "0"}], "}"}], ",",
       "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"g", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"m1", "+", "m2"}], ")"}], "/", 
          RowBox[{"(", 
           RowBox[{"l", " ", "m1"}], ")"}]}]}], ",", " ", "0", ",", " ", "0", 
        ",", " ", "0"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "0", ",", "1"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"g", " ", 
         RowBox[{"m2", "/", "m1"}]}], ",", "0", ",", "0", ",", "0"}], "}"}]}],
      "\[IndentingNewLine]", "}"}]}], ";"}]}]], "Input",
 CellChangeTimes->{{3.907269034292457*^9, 3.907269083071683*^9}, {
   3.907269219878908*^9, 3.907269233329109*^9}, {3.913226180833213*^9, 
   3.913226184470039*^9}, 3.9132269077658157`*^9, {3.9146189448396883`*^9, 
   3.914618947708054*^9}, {3.915055409749658*^9, 3.9150554181135406`*^9}},
 CellLabel->"In[12]:=",ExpressionUUID->"e96051a0-b560-4726-9c3c-aea3d0032c46"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"The", " ", "input", " ", "matrix"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"b", "=", 
   RowBox[{"{", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", "0", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"1", "/", 
       RowBox[{"(", 
        RowBox[{"l", " ", "m1"}], ")"}]}], "}"}], ",", "\[IndentingNewLine]", 
     
     RowBox[{"{", "0", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"1", "/", "m1"}], "}"}]}], "\[IndentingNewLine]", 
    "}"}]}]}]], "Input",
 CellChangeTimes->{{3.9072690852691507`*^9, 3.907269102735827*^9}, {
   3.9072692346412277`*^9, 3.9072692394459867`*^9}, {3.915055422725024*^9, 
   3.915055424418935*^9}, 3.9154944415874043`*^9},
 CellLabel->"In[29]:=",ExpressionUUID->"8d3a6bc2-d93d-47d3-9341-a8388e2c95b8"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", "0", "}"}], ",", 
   RowBox[{"{", "22.57846014901784`", "}"}], ",", 
   RowBox[{"{", "0", "}"}], ",", 
   RowBox[{"{", "9.708737864077671`", "}"}]}], "}"}]], "Output",
 CellChangeTimes->{3.915494441816123*^9},
 CellLabel->"Out[29]=",ExpressionUUID->"8f15af03-fe1e-42cb-86e6-ee092701f173"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"The", " ", "state", " ", "cost", " ", "matrix"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"q", " ", "=", " ", 
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"0", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "0", ",", "1"}], "}"}]}], 
     "\[IndentingNewLine]", "}"}]}], ";"}]}]], "Input",
 CellChangeTimes->{{3.907269243428879*^9, 3.907269258248438*^9}, {
   3.907270784117153*^9, 3.907270823099234*^9}, {3.907270857878899*^9, 
   3.9072708600987062`*^9}, {3.9072709192292643`*^9, 3.907270964286902*^9}, {
   3.907297419459434*^9, 3.9072974222668667`*^9}, {3.907297520522088*^9, 
   3.907297520638092*^9}, {3.907297560860964*^9, 3.907297563636188*^9}, {
   3.912209809940818*^9, 3.912209849046074*^9}, {3.91221082733427*^9, 
   3.9122108632139893`*^9}, {3.912212891115103*^9, 3.912212932407578*^9}, {
   3.912213095432444*^9, 3.912213112127915*^9}, {3.912215040503098*^9, 
   3.9122150476971893`*^9}, {3.9122153910967913`*^9, 3.912215394793602*^9}, 
   3.9144464822472267`*^9, 3.914446560030002*^9, {3.915058693462399*^9, 
   3.915058707651256*^9}, 3.9152502349015493`*^9, 3.915250281843133*^9, 
   3.915250496377705*^9, {3.915250556361936*^9, 3.915250563058217*^9}},
 CellLabel->"In[14]:=",ExpressionUUID->"88ef9c9d-93b3-45ec-86ba-39c0a923f31a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"The", " ", "input", " ", "cost", " ", "matrix"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"r", " ", "=", 
    RowBox[{"{", 
     RowBox[{"{", "1", "}"}], "}"}]}], ";"}]}]], "Input",
 CellChangeTimes->{{3.907269259731913*^9, 3.907269270128323*^9}, {
   3.9072708314711227`*^9, 3.907270833549348*^9}, {3.907271183227652*^9, 
   3.9072712031318417`*^9}, {3.907297453589212*^9, 3.907297456982827*^9}, {
   3.9072975160416737`*^9, 3.90729753530124*^9}, {3.9150586549396343`*^9, 
   3.9150587404450397`*^9}, {3.9150592359416943`*^9, 3.915059259728631*^9}, {
   3.91524978303959*^9, 3.915249783842588*^9}, {3.915249993953588*^9, 
   3.915249994704463*^9}, 3.915250048457046*^9, 3.915250092037678*^9, 
   3.915250168271199*^9, {3.915250227839764*^9, 3.915250228666273*^9}, 
   3.9154167691446733`*^9, 3.915423911567811*^9, {3.915424093800686*^9, 
   3.915424094105448*^9}},
 CellLabel->"In[15]:=",ExpressionUUID->"b2a58f56-7d7c-4a59-99cd-49fa404f6dc5"],

Cell["\<\

Determine the continuous state feedback matrix via the linear quadratic \
regulator algorithm\
\>", "Text",
 CellChangeTimes->{{3.907269288863618*^9, 3.907269308798046*^9}, {
  3.9072693493814287`*^9, 3.907269371834427*^9}, {3.914619069457794*^9, 
  3.914619086589501*^9}},ExpressionUUID->"490710fd-1caf-4cfb-ade3-\
afedef94e2be"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"The", " ", "state", " ", "feedback", " ", "matrix"}], " ", "*)"}],
   "\[IndentingNewLine]", 
  RowBox[{"k", "=", 
   RowBox[{"LQRegulatorGains", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"StateSpaceModel", "[", 
      RowBox[{"{", 
       RowBox[{"a", ",", " ", "b", ",", " ", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0", ",", 
          RowBox[{"{", 
           RowBox[{"4", ",", "4"}], "}"}]}], "]"}], ",", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0", ",", 
          RowBox[{"{", 
           RowBox[{"4", ",", "1"}], "}"}]}], "]"}]}], "}"}], "]"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"q", ",", "r"}], "}"}]}], "\[IndentingNewLine]", 
    "]"}]}]}]], "Input",
 CellChangeTimes->{{3.9072693747227373`*^9, 3.907269420168392*^9}, {
   3.907270225959902*^9, 3.907270231458763*^9}, 3.912210891181642*^9, 
   3.9122151340886927`*^9, 3.913162010584063*^9, {3.913223357085012*^9, 
   3.913223372082643*^9}, {3.913226309364902*^9, 3.9132263119634666`*^9}, 
   3.913226362170413*^9, 3.9132277123300447`*^9, 3.914619036936549*^9, {
   3.915057100010233*^9, 3.915057103898896*^9}, 3.915058440297555*^9},
 CellLabel->"In[16]:=",ExpressionUUID->"ab4a64ba-6053-4fe0-824f-0f8fc2644d5a"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"{", 
   RowBox[{"9.589862745874797`", ",", "2.108796180573232`", ",", 
    RowBox[{"-", "0.9999999999999467`"}], ",", 
    RowBox[{"-", "1.6183679575722731`"}]}], "}"}], "}"}]], "Output",
 CellChangeTimes->{
  3.9150585574601316`*^9, {3.91505866095077*^9, 3.915058744001646*^9}, {
   3.915058975459985*^9, 3.915058991714423*^9}, {3.915059214872444*^9, 
   3.915059262224523*^9}, {3.915249195114904*^9, 3.915249200131167*^9}, 
   3.915249786656054*^9, 3.915249997502269*^9, 3.915250050835878*^9, 
   3.915250096787725*^9, 3.915250170516739*^9, 3.9152502427177553`*^9, 
   3.915250285817244*^9, 3.9152505008001623`*^9, 3.9152505660667667`*^9, 
   3.915416702660659*^9, 3.915416771765338*^9, 3.915423916314229*^9, 
   3.915424000598442*^9, {3.9154240985064*^9, 3.915424110823251*^9}, 
   3.91542442096984*^9, 3.915494310200747*^9},
 CellLabel->"Out[16]=",ExpressionUUID->"07a509bb-afdc-49bb-9304-02ea578a7de1"]
}, Open  ]],

Cell["\<\

Confirm the eigenvalues of the resulting matrix don\[CloseCurlyQuote]t have \
positive real parts\
\>", "Text",
 CellChangeTimes->{{3.915058951289201*^9, 
  3.9150589895268373`*^9}},ExpressionUUID->"bdf12cb0-fb9f-4aa7-a8ad-\
4282b72dbc6e"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Eigenvalues", "[", 
  RowBox[{"a", "-", 
   RowBox[{"b", ".", "k"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.9150589689619083`*^9, 3.915059025974513*^9}},
 CellLabel->"In[17]:=",ExpressionUUID->"ba24c501-1afd-4628-89db-49c1656d0a58"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    RowBox[{"-", "25.875592830218398`"}], "+", 
    RowBox[{"0.`", " ", "\[ImaginaryI]"}]}], ",", 
   RowBox[{
    RowBox[{"-", "2.5050126229293572`"}], "+", 
    RowBox[{"1.4649673392076443`", " ", "\[ImaginaryI]"}]}], ",", 
   RowBox[{
    RowBox[{"-", "2.5050126229293572`"}], "-", 
    RowBox[{"1.4649673392076443`", " ", "\[ImaginaryI]"}]}], ",", 
   RowBox[{
    RowBox[{"-", "1.015442181704674`"}], "+", 
    RowBox[{"0.`", " ", "\[ImaginaryI]"}]}]}], "}"}]], "Output",
 CellChangeTimes->{{3.915058975478362*^9, 3.915059026222259*^9}, {
   3.915059214875045*^9, 3.915059262229195*^9}, {3.915249195275958*^9, 
   3.915249200163652*^9}, 3.915249786683689*^9, 3.915249997505157*^9, 
   3.915250050838868*^9, 3.91525009679038*^9, 3.915250170548078*^9, 
   3.91525024272066*^9, 3.9152502858197803`*^9, 3.9152505008026953`*^9, 
   3.915250566070985*^9, 3.9154167027980413`*^9, 3.915416771786228*^9, 
   3.915423916460322*^9, 3.9154240006139517`*^9, {3.915424098508902*^9, 
   3.915424110825502*^9}, 3.915424420972312*^9, 3.915494310343289*^9},
 CellLabel->"Out[17]=",ExpressionUUID->"3f035d5a-12c8-4027-8e15-744d5c07d8c7"]
}, Open  ]],

Cell["\<\

Generate an animation\
\>", "Text",
 CellChangeTimes->{{3.9072696302874823`*^9, 3.9072696326238823`*^9}, {
  3.9072699087778807`*^9, 
  3.907269914935526*^9}},ExpressionUUID->"d69ce8e4-cb0c-44ac-be90-\
fcd1f9773a59"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Animate", "[", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"\[Theta]", ",", "\[Omega]", ",", "x", ",", "v"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", "\[Theta]", "}"}], ",", 
         RowBox[{"{", "\[Omega]", "}"}], ",", 
         RowBox[{"{", "x", "}"}], ",", 
         RowBox[{"{", "v", "}"}]}], "}"}], "=", 
       RowBox[{
        RowBox[{"MatrixExp", "[", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"a", "-", 
            RowBox[{"b", ".", "k"}]}], ")"}], "t"}], "]"}], ".", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", "\[Theta]0", "}"}], ",", 
          RowBox[{"{", "\[Omega]0", "}"}], ",", 
          RowBox[{"{", "x0", "}"}], ",", 
          RowBox[{"{", "v0", "}"}]}], "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"drawInvertedPendulum", "[", 
       RowBox[{"l", ",", "\[Theta]", ",", "x"}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{"t", ",", "0", ",", "tMax"}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"AnimationRunning", "->", "False"}], ",", "\[IndentingNewLine]", 
   RowBox[{"DefaultDuration", "->", "tMax"}]}], "\[IndentingNewLine]", 
  "]"}]], "Input",
 CellChangeTimes->{{3.907269918491808*^9, 3.90727011480219*^9}, {
   3.907270167898347*^9, 3.9072701681125183`*^9}, {3.907270245924966*^9, 
   3.9072702534041033`*^9}, {3.9072702973811703`*^9, 
   3.9072703239863453`*^9}, {3.907270395492546*^9, 3.90727043202778*^9}, {
   3.907270595104821*^9, 3.907270681908853*^9}, {3.907426617524706*^9, 
   3.9074266193847647`*^9}, {3.907437309946548*^9, 3.907437313937688*^9}, {
   3.9074373602350883`*^9, 3.907437360815195*^9}, {3.907437622347724*^9, 
   3.907437623572891*^9}, 3.907438099355225*^9, {3.9150590515269947`*^9, 
   3.9150590544027357`*^9}},
 CellLabel->"In[18]:=",ExpressionUUID->"6129bcbc-82aa-4e47-9b4c-64a1a6e85073"],

Cell[BoxData[
 TagBox[
  StyleBox[
   DynamicModuleBox[{$CellContext`t$$ = 2.12795352935791, Typeset`show$$ = 
    True, Typeset`bookmarkList$$ = {}, Typeset`bookmarkMode$$ = "Menu", 
    Typeset`animator$$, Typeset`animvar$$ = 1, Typeset`name$$ = 
    "\"untitled\"", Typeset`specs$$ = {{
      Hold[$CellContext`t$$], 0, 10}}, Typeset`size$$ = {720., {57., 68.}}, 
    Typeset`update$$ = 0, Typeset`initDone$$, Typeset`skipInitDone$$ = True}, 
    
    DynamicBox[Manipulate`ManipulateBoxes[
     1, StandardForm, "Variables" :> {$CellContext`t$$ = 0}, 
      "ControllerVariables" :> {}, 
      "OtherVariables" :> {
       Typeset`show$$, Typeset`bookmarkList$$, Typeset`bookmarkMode$$, 
        Typeset`animator$$, Typeset`animvar$$, Typeset`name$$, 
        Typeset`specs$$, Typeset`size$$, Typeset`update$$, Typeset`initDone$$,
         Typeset`skipInitDone$$}, "Body" :> 
      Module[{$CellContext`\[Theta]$, $CellContext`\[Omega]$, \
$CellContext`x$, $CellContext`v$}, {{$CellContext`\[Theta]$}, {$CellContext`\
\[Omega]$}, {$CellContext`x$}, {$CellContext`v$}} = Dot[
           
           MatrixExp[($CellContext`a - 
             Dot[$CellContext`b, $CellContext`k]) $CellContext`t$$], \
{{$CellContext`\[Theta]0}, {$CellContext`\[Omega]0}, {$CellContext`x0}, \
{$CellContext`v0}}]; $CellContext`drawInvertedPendulum[$CellContext`l, \
$CellContext`\[Theta]$, $CellContext`x$]], 
      "Specifications" :> {{$CellContext`t$$, 0, 10, AnimationRunning -> 
         False, DefaultDuration -> 10, 
         AppearanceElements -> {
          "ProgressSlider", "PlayPauseButton", "FasterSlowerButtons", 
           "DirectionButton"}}}, 
      "Options" :> {
       ControlType -> Animator, AppearanceElements -> None, DefaultBaseStyle -> 
        "Animate", DefaultLabelStyle -> "AnimateLabel", SynchronousUpdating -> 
        True, ShrinkingDelay -> 20.}, "DefaultOptions" :> {}],
     ImageSizeCache->{764., {97., 102.}},
     SingleEvaluation->True],
    Deinitialization:>None,
    DynamicModuleValues:>{},
    SynchronousInitialization->True,
    UndoTrackedVariables:>{Typeset`show$$, Typeset`bookmarkMode$$},
    UnsavedVariables:>{Typeset`initDone$$},
    UntrackedVariables:>{Typeset`size$$}], "Animate",
   Deployed->True,
   StripOnInput->False],
  Manipulate`InterpretManipulate[1]]], "Output",
 CellChangeTimes->{{3.9072702981653976`*^9, 3.9072703249620857`*^9}, {
   3.907270401995171*^9, 3.9072704336794977`*^9}, {3.907270601707574*^9, 
   3.907270635550201*^9}, 3.907270685186146*^9, {3.907270715502615*^9, 
   3.907270775118154*^9}, {3.9072708437840843`*^9, 3.907270990224618*^9}, 
   3.907271044867278*^9, {3.907271186558876*^9, 3.907271205185663*^9}, {
   3.907297385782449*^9, 3.907297406430902*^9}, 3.9072974758938007`*^9, {
   3.907297525980933*^9, 3.907297565880731*^9}, 3.90742657887683*^9, 
   3.907426621909421*^9, 3.90743731882616*^9, {3.907437361859664*^9, 
   3.907437386022812*^9}, {3.907437421461882*^9, 3.9074374338813543`*^9}, {
   3.907437612707385*^9, 3.9074376255950747`*^9}, {3.907437734528468*^9, 
   3.907437784076428*^9}, {3.907437843418971*^9, 3.907437882312674*^9}, {
   3.907437946006015*^9, 3.907437964194442*^9}, {3.907438099667898*^9, 
   3.907438125369775*^9}, 3.9074384619005327`*^9, 3.907438552384962*^9, 
   3.912209741341586*^9, 3.912209778170247*^9, {3.912209815540414*^9, 
   3.912209851305484*^9}, {3.912210831042346*^9, 3.91221088505398*^9}, 
   3.912211687910922*^9, {3.912212905076906*^9, 3.912212947933044*^9}, {
   3.9122130985547447`*^9, 3.912213115929516*^9}, 3.9122151439764223`*^9, 
   3.912215397887662*^9, 3.913161982559013*^9, 3.913162892265951*^9, 
   3.913173966121478*^9, {3.913223378031971*^9, 3.913223392718471*^9}, 
   3.913226248906907*^9, {3.9132263376685677`*^9, 3.9132263650641623`*^9}, 
   3.913227333622798*^9, {3.91322751237503*^9, 3.913227535055606*^9}, {
   3.913227585254068*^9, 3.9132275902928467`*^9}, 3.913228461127033*^9, 
   3.913228849359967*^9, 3.913260869086658*^9, 3.913261085565363*^9, 
   3.913328995206251*^9, 3.91332906307789*^9, {3.913669672900861*^9, 
   3.913669678986966*^9}, 3.913670810492208*^9, 3.914446098508471*^9, 
   3.914446487601893*^9, 3.914446563181692*^9, 3.914553610282473*^9, 
   3.914553791133028*^9, {3.914553840204941*^9, 3.9145538797859383`*^9}, 
   3.914554356527535*^9, 3.914554726487586*^9, 3.9145564789672318`*^9, 
   3.914556559884025*^9, 3.9145566701159487`*^9, 3.914619047189026*^9, {
   3.914619224483101*^9, 3.914619246159786*^9}, 3.914619326135085*^9, 
   3.915055440241274*^9, 3.9150571019443607`*^9, 3.915058557465972*^9, {
   3.9150586610026913`*^9, 3.915058744007772*^9}, {3.915058975492487*^9, 
   3.915058991831443*^9}, 3.9150590549183598`*^9, {3.915059214888482*^9, 
   3.915059262262403*^9}, {3.91524919531538*^9, 3.915249200198998*^9}, 
   3.9152497867187767`*^9, 3.9152499975137863`*^9, 3.915250050845428*^9, 
   3.91525009679566*^9, 3.915250170577045*^9, 3.9152502427277107`*^9, 
   3.915250285825*^9, 3.9152505008079243`*^9, 3.915250566114068*^9, 
   3.915416702808261*^9, 3.915416771792219*^9, 3.915423916484703*^9, 
   3.915424000619893*^9, {3.915424098513891*^9, 3.915424110830538*^9}, 
   3.9154244209772873`*^9, 3.91549431036639*^9},
 CellLabel->"Out[18]=",ExpressionUUID->"478bef4c-0e8e-4bb2-a961-252c4f9aca49"]
}, Open  ]],

Cell["\<\

Uncomment to export a GIF of the animation\
\>", "Text",
 CellChangeTimes->{{3.907261862895178*^9, 3.907261867161022*^9}, {
  3.907268256227379*^9, 
  3.907268258069295*^9}},ExpressionUUID->"de232541-9603-4bb2-91c2-\
724709e33734"],

Cell[BoxData[
 RowBox[{" ", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Export", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"FileNameJoin", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"NotebookDirectory", "[", "]"}], ",", 
         "\"\<controlled.gif\>\""}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Module", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"\[Theta]", ",", "\[Omega]", ",", "x", ",", "v"}], "}"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", "\[Theta]", "}"}], ",", 
              RowBox[{"{", "\[Omega]", "}"}], ",", 
              RowBox[{"{", "x", "}"}], ",", 
              RowBox[{"{", "v", "}"}]}], "}"}], "=", 
            RowBox[{
             RowBox[{"MatrixExp", "[", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"a", "-", 
                 RowBox[{"b", ".", "k"}]}], ")"}], "t"}], "]"}], ".", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", "\[Theta]0", "}"}], ",", 
               RowBox[{"{", "\[Omega]0", "}"}], ",", 
               RowBox[{"{", "x0", "}"}], ",", 
               RowBox[{"{", "v0", "}"}]}], "}"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"drawInvertedPendulum", "[", 
            RowBox[{"l", ",", " ", "\[Theta]", ",", "x"}], "]"}]}]}], 
         "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"t", ",", "0", ",", "tMax", ",", 
          RowBox[{"1", "/", "24"}]}], "}"}]}], "\[IndentingNewLine]", "]"}], 
      ",", "\[IndentingNewLine]", 
      RowBox[{"DisplayDurations", "->", 
       RowBox[{"1", "/", "24"}]}]}], "\[IndentingNewLine]", "]"}], ";"}], " ",
    "*)"}]}]], "Input",
 CellChangeTimes->{{3.907261774382659*^9, 3.907261906681417*^9}, 
   3.907261945528573*^9, {3.9072682649416723`*^9, 3.9072682903037853`*^9}, {
   3.907271017286531*^9, 3.907271017412315*^9}, {3.907271052639763*^9, 
   3.907271069619214*^9}, {3.907271124798566*^9, 3.907271172390579*^9}, {
   3.907438544903363*^9, 3.907438576956613*^9}, {3.9146192651989717`*^9, 
   3.914619290847105*^9}, {3.9146193574229383`*^9, 3.91461937320932*^9}},
 CellLabel->"In[19]:=",ExpressionUUID->"92f50f51-3ccc-4809-83b3-6818af9d2b8e"],

Cell["\<\

Determine the discrete state feedback matrix via the linear quadratic \
regulator algorithm\
\>", "Text",
 CellChangeTimes->{{3.914619187658607*^9, 3.914619211749735*^9}, 
   3.915249195736425*^9},ExpressionUUID->"4327068b-6a60-496c-885c-\
b5669eb42624"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Sampling", " ", "period"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"\[Tau]", "=", "0.002"}], ";"}]}]], "Input",
 CellLabel->"In[20]:=",ExpressionUUID->"fd0efb17-3c5d-4226-96b4-02d0cfebf42d"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"kd", "=", 
  RowBox[{"DiscreteLQRegulatorGains", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"StateSpaceModel", "[", 
     RowBox[{"{", 
      RowBox[{"a", ",", " ", "b", ",", " ", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0", ",", 
         RowBox[{"{", 
          RowBox[{"4", ",", "4"}], "}"}]}], "]"}], ",", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0", ",", 
         RowBox[{"{", 
          RowBox[{"4", ",", "1"}], "}"}]}], "]"}]}], "}"}], "]"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{"q", ",", "r"}], "}"}], ",", "\[IndentingNewLine]", "\[Tau]"}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.913227102052188*^9, 3.913227114089877*^9}, 
   3.91322758801562*^9, {3.914553711625638*^9, 3.914553712443494*^9}, {
   3.914556525841207*^9, 3.9145565267563543`*^9}, {3.914619175862431*^9, 
   3.914619176584564*^9}, 3.9146192154622507`*^9, 3.915249197373733*^9},
 CellLabel->"In[21]:=",ExpressionUUID->"fdb19994-0334-4af9-9aac-f53b709518b1"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"{", 
   RowBox[{"9.357766040688169`", ",", "2.0523757232796784`", ",", 
    RowBox[{"-", "0.9687949709738775`"}], ",", 
    RowBox[{"-", "1.5688420634470346`"}]}], "}"}], "}"}]], "Output",
 CellChangeTimes->{
  3.9152492002783747`*^9, 3.915249786807626*^9, 3.915249997601264*^9, 
   3.915250050954762*^9, 3.915250096894237*^9, 3.915250170681106*^9, 
   3.915250242834134*^9, 3.915250285921811*^9, 3.9152505008918667`*^9, 
   3.9152505662101917`*^9, 3.915416703026805*^9, 3.915416771850278*^9, 
   3.915423916681438*^9, 3.915424000679969*^9, {3.915424098561591*^9, 
   3.915424110879374*^9}, 3.915424421030545*^9, 3.9154943104227343`*^9},
 CellLabel->"Out[21]=",ExpressionUUID->"899457c1-bf9b-466d-9d5a-7e1bd704bfb9"]
}, Open  ]]
},
WindowSize->{1440, 847},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
FrontEndVersion->"13.3 for Mac OS X ARM (64-bit) (June 3, 2023)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"f5e533c5-b18b-4b07-b878-812fb6fc2781"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 253, 8, 81, "Text",ExpressionUUID->"0fe5ad29-3401-4caf-8504-3a70af6fc6f8"],
Cell[814, 30, 294, 6, 30, "Input",ExpressionUUID->"a98d723e-79f2-4a1f-91f4-dc4199237fcd"],
Cell[1111, 38, 212, 3, 30, "Input",ExpressionUUID->"e35fe735-c611-40a1-ac76-b56affe3acc8"],
Cell[1326, 43, 167, 6, 58, "Text",ExpressionUUID->"9f09f415-a7d0-48f3-9ca9-5597bf6978c2"],
Cell[1496, 51, 532, 12, 52, "Input",ExpressionUUID->"127b8550-8a2b-43df-8ffe-22bfb3da5f37"],
Cell[2031, 65, 570, 12, 52, "Input",ExpressionUUID->"73fec481-6ffd-4575-bb1c-328ed8894f1c"],
Cell[2604, 79, 738, 14, 52, "Input",ExpressionUUID->"f98da995-ad72-405f-9c38-8ac29a0208f3"],
Cell[3345, 95, 637, 13, 52, "Input",ExpressionUUID->"7393db73-33a9-4bc9-8ca7-fd291343cdb4"],
Cell[3985, 110, 499, 11, 52, "Input",ExpressionUUID->"4bc6e4cb-4e47-43b3-b020-5b0802cbf28f"],
Cell[4487, 123, 199, 6, 58, "Text",ExpressionUUID->"790e9bb2-8f5a-47ae-939e-21677a893ff3"],
Cell[4689, 131, 1209, 21, 52, "Input",ExpressionUUID->"79887e5c-eb7b-4a70-b0e9-969ec65c98a6"],
Cell[5901, 154, 862, 16, 52, "Input",ExpressionUUID->"d3c23cee-7866-47a4-9538-1454bee2a786"],
Cell[6766, 172, 468, 10, 52, "Input",ExpressionUUID->"86397208-e411-4e20-acb3-989bb4000928"],
Cell[7237, 184, 491, 11, 52, "Input",ExpressionUUID->"44b7c4ca-50d2-4083-b7ca-a950d5f44d6a"],
Cell[7731, 197, 369, 8, 58, "Text",ExpressionUUID->"b7260e88-9646-422b-9c7f-4c9c3fe63308"],
Cell[8103, 207, 1350, 33, 157, "Input",ExpressionUUID->"e96051a0-b560-4726-9c3c-aea3d0032c46"],
Cell[CellGroupData[{
Cell[9478, 244, 860, 21, 157, "Input",ExpressionUUID->"8d3a6bc2-d93d-47d3-9341-a8388e2c95b8"],
Cell[10341, 267, 344, 8, 34, "Output",ExpressionUUID->"8f15af03-fe1e-42cb-86e6-ee092701f173"]
}, Open  ]],
Cell[10700, 278, 1686, 33, 157, "Input",ExpressionUUID->"88ef9c9d-93b3-45ec-86ba-39c0a923f31a"],
Cell[12389, 313, 1024, 19, 52, "Input",ExpressionUUID->"b2a58f56-7d7c-4a59-99cd-49fa404f6dc5"],
Cell[13416, 334, 341, 8, 58, "Text",ExpressionUUID->"490710fd-1caf-4cfb-ade3-afedef94e2be"],
Cell[CellGroupData[{
Cell[13782, 346, 1311, 29, 115, "Input",ExpressionUUID->"ab4a64ba-6053-4fe0-824f-0f8fc2644d5a"],
Cell[15096, 377, 947, 16, 34, "Output",ExpressionUUID->"07a509bb-afdc-49bb-9304-02ea578a7de1"]
}, Open  ]],
Cell[16058, 396, 250, 7, 58, "Text",ExpressionUUID->"bdf12cb0-fb9f-4aa7-a8ad-4282b72dbc6e"],
Cell[CellGroupData[{
Cell[16333, 407, 258, 5, 30, "Input",ExpressionUUID->"ba24c501-1afd-4628-89db-49c1656d0a58"],
Cell[16594, 414, 1175, 23, 34, "Output",ExpressionUUID->"3f035d5a-12c8-4027-8e15-744d5c07d8c7"]
}, Open  ]],
Cell[17784, 440, 227, 7, 58, "Text",ExpressionUUID->"d69ce8e4-cb0c-44ac-be90-fcd1f9773a59"],
Cell[CellGroupData[{
Cell[18036, 451, 2063, 45, 220, "Input",ExpressionUUID->"6129bcbc-82aa-4e47-9b4c-64a1a6e85073"],
Cell[20102, 498, 5264, 87, 218, "Output",ExpressionUUID->"478bef4c-0e8e-4bb2-a961-252c4f9aca49"]
}, Open  ]],
Cell[25381, 588, 242, 7, 58, "Text",ExpressionUUID->"de232541-9603-4bb2-91c2-724709e33734"],
Cell[25626, 597, 2457, 55, 262, "Input",ExpressionUUID->"92f50f51-3ccc-4809-83b3-6818af9d2b8e"],
Cell[28086, 654, 265, 7, 58, "Text",ExpressionUUID->"4327068b-6a60-496c-885c-b5669eb42624"],
Cell[28354, 663, 268, 6, 52, "Input",ExpressionUUID->"fd0efb17-3c5d-4226-96b4-02d0cfebf42d"],
Cell[CellGroupData[{
Cell[28647, 673, 1053, 23, 115, "Input",ExpressionUUID->"fdb19994-0334-4af9-9aac-f53b709518b1"],
Cell[29703, 698, 756, 13, 34, "Output",ExpressionUUID->"899457c1-bf9b-466d-9d5a-7e1bd704bfb9"]
}, Open  ]]
}
]
*)

